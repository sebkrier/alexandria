{#
  Providers List Partial - for HTMX swap after add/update/delete

  Expected context:
    - providers: list of provider dicts
#}

{% from 'components/icons.html' import key, check_circle, circle, trash_2, loader_2, bot %}

{% if providers and providers|length > 0 %}
<div class="space-y-2">
    {% for provider in providers %}
    <div
        id="provider-{{ provider.id }}"
        class="group flex items-center gap-4 p-4 rounded-lg border transition-all cursor-pointer
            {% if provider.is_default %}
                bg-article-blue/10 border-article-blue/50 ring-1 ring-article-blue/30
            {% else %}
                bg-dark-bg border-dark-border hover:border-dark-hover
            {% endif %}"
        hx-post="/app/settings/providers/{{ provider.id }}/default"
        hx-target="#providers-list"
        hx-swap="innerHTML"
    >
        {# Selection indicator #}
        <div class="flex-shrink-0">
            {% if provider.is_default %}
                {{ check_circle('w-5 h-5 text-article-blue') }}
            {% else %}
                {{ circle('w-5 h-5 text-dark-muted group-hover:text-dark-text') }}
            {% endif %}
        </div>

        {# Provider icon #}
        <div class="flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center
            {% if provider.provider_name == 'anthropic' %}bg-orange-500/20
            {% elif provider.provider_name == 'openai' %}bg-green-500/20
            {% elif provider.provider_name == 'google' %}bg-blue-500/20
            {% else %}bg-dark-hover{% endif %}">
            {{ key('w-5 h-5 text-dark-text') }}
        </div>

        {# Provider info #}
        <div class="flex-1 min-w-0">
            <div class="flex items-center gap-2">
                <span class="font-medium text-white truncate">{{ provider.display_name }}</span>
                {% if provider.is_default %}
                <span class="flex-shrink-0 px-2 py-0.5 text-xs font-medium text-article-blue bg-article-blue/20 rounded">
                    Active
                </span>
                {% endif %}
            </div>
            <p class="text-sm text-dark-muted truncate">
                {{ provider.model_id }} &middot; {{ provider.api_key_masked }}
            </p>
        </div>

        {# Actions #}
        <div class="flex-shrink-0 flex items-center gap-1" onclick="event.stopPropagation()">
            {# Test button #}
            <button
                hx-post="/app/settings/providers/{{ provider.id }}/test"
                hx-target="#toast-container"
                hx-swap="beforeend"
                hx-indicator="#test-{{ provider.id }}"
                class="px-3 py-1.5 text-sm text-dark-muted hover:text-white rounded-lg hover:bg-dark-hover transition-colors"
                title="Test connection"
            >
                <span class="htmx-indicator" id="test-{{ provider.id }}">
                    {{ loader_2('w-4 h-4 animate-spin') }}
                </span>
                <span class="htmx-hide-indicator">Test</span>
            </button>

            {# Delete button #}
            <button
                hx-delete="/app/settings/providers/{{ provider.id }}"
                hx-target="#provider-{{ provider.id }}"
                hx-swap="outerHTML"
                hx-confirm="Are you sure you want to delete this provider?"
                class="p-1.5 text-dark-muted hover:text-article-red rounded-lg hover:bg-dark-hover transition-colors"
                title="Delete provider"
            >
                {{ trash_2('w-4 h-4') }}
            </button>
        </div>
    </div>
    {% endfor %}
</div>

<p class="mt-3 text-xs text-dark-muted">
    Click on a provider to make it active. The active provider will be used for all AI operations.
</p>
{% else %}
<div class="py-8 text-center text-dark-muted">
    {{ bot('w-12 h-12 mx-auto mb-3 opacity-50') }}
    <p>No AI providers configured</p>
    <p class="text-sm mt-1">Add a provider to enable AI-powered summaries and categorization</p>
</div>
{% endif %}
