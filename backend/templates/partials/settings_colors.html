{#
  Color Labels Settings Section

  Expected context:
    - colors: list of color dicts with id, name, hex_value
#}

{% from 'components/icons.html' import plus, trash_2 %}

<section id="colors-section" class="bg-dark-surface border border-dark-border rounded-lg p-5">
    <div class="flex items-center justify-between mb-4">
        <div>
            <h2 class="text-base font-semibold text-white">Color Labels</h2>
            <p class="text-xs text-dark-muted mt-1">
                Customize color labels for organizing articles
            </p>
        </div>
        <div id="add-color-form-container" x-data="{ showForm: false }">
            <button
                @click="showForm = true"
                x-show="!showForm"
                class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium text-white bg-article-blue rounded-lg hover:bg-article-blue/90 transition-colors whitespace-nowrap flex-shrink-0"
            >
                {{ plus("w-3.5 h-3.5") }}
                Add Color
            </button>

            {# Add color form #}
            <form
                x-show="showForm"
                x-cloak
                hx-post="/app/settings/colors"
                hx-target="#colors-section"
                hx-swap="outerHTML"
                class="flex items-center gap-2"
            >
                <input
                    type="color"
                    name="hex_value"
                    value="#808080"
                    class="w-7 h-7 rounded cursor-pointer border-0 bg-transparent"
                >
                <input
                    type="text"
                    name="name"
                    placeholder="Color name..."
                    required
                    class="px-2 py-1 bg-dark-bg border border-dark-border rounded text-xs text-dark-text placeholder-dark-muted focus:outline-none focus:ring-1 focus:ring-article-blue"
                >
                <button
                    type="submit"
                    class="px-2.5 py-1 bg-article-blue text-white text-xs rounded hover:bg-article-blue/90 transition-colors"
                >
                    Add
                </button>
                <button
                    type="button"
                    @click="showForm = false"
                    class="px-2.5 py-1 bg-dark-bg border border-dark-border text-dark-text text-xs rounded hover:bg-dark-hover transition-colors"
                >
                    Cancel
                </button>
            </form>
        </div>
    </div>

    {# Colors list - can be swapped via HTMX #}
    <div id="colors-list">
        {% if colors and colors|length > 0 %}
        <div class="grid grid-cols-2 gap-2">
            {% for color in colors %}
            <div
                id="color-{{ color.id }}"
                class="flex items-center gap-2 p-2 bg-dark-bg rounded-lg border border-dark-border group"
            >
                <div
                    class="w-3.5 h-3.5 rounded-full flex-shrink-0"
                    style="background-color: {{ color.hex_value }};"
                ></div>
                <input
                    type="text"
                    value="{{ color.name }}"
                    hx-patch="/app/settings/colors/{{ color.id }}"
                    hx-trigger="blur changed, keyup[key=='Enter']"
                    hx-target="#colors-section"
                    hx-swap="outerHTML"
                    hx-include="this"
                    name="name"
                    class="flex-1 bg-transparent text-dark-text border-none outline-none focus:ring-1 focus:ring-article-blue rounded px-1 text-xs min-w-0"
                >
                <button
                    hx-delete="/app/settings/colors/{{ color.id }}"
                    hx-target="#colors-section"
                    hx-swap="outerHTML"
                    hx-confirm="Delete this color? Articles using it will have their color cleared."
                    class="p-0.5 text-dark-muted hover:text-article-red transition-colors opacity-0 group-hover:opacity-100"
                    title="Delete color"
                >
                    {{ trash_2("w-3.5 h-3.5") }}
                </button>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="py-3 text-center text-dark-muted">
            <p class="text-xs">No color labels configured</p>
        </div>
        {% endif %}
    </div>
</section>

{# Out-of-band swap to update sidebar colors (hidden on page, used by HTMX) #}
<div id="sidebar-colors" hx-swap-oob="true" class="mt-6" hidden>
    {% if colors and colors|length > 0 %}
    <div class="flex items-center justify-between mb-2 px-3">
        <span class="text-xs font-semibold text-dark-muted uppercase tracking-wider">
            Colors
        </span>
    </div>
    <div class="space-y-0.5">
        {% for color in colors %}
        <a
            href="/app/?color_id={{ color.id }}"
            class="w-full flex items-center gap-2 px-3 py-1.5 text-sm rounded-lg transition-colors text-dark-muted hover:text-dark-text hover:bg-dark-hover"
        >
            <div
                class="w-4 h-4 rounded-full"
                style="background-color: {{ color.hex_value }};"
            ></div>
            <span class="flex-1 text-left truncate">{{ color.name }}</span>
        </a>
        {% endfor %}
    </div>
    {% endif %}
</div>
