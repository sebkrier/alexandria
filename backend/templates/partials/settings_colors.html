{#
  Color Labels Settings Section

  Expected context:
    - colors: list of color dicts with id, name, hex_value
#}

{% from 'components/icons.html' import plus, trash_2 %}

<section id="colors-section" class="bg-dark-surface border border-dark-border rounded-lg p-6">
    <div class="flex items-center justify-between mb-4">
        <div>
            <h2 class="text-lg font-semibold text-white">Color Labels</h2>
            <p class="text-sm text-dark-muted mt-1">
                Customize color labels for organizing articles
            </p>
        </div>
        <div x-data="{ showForm: false }">
            <button
                @click="showForm = true"
                x-show="!showForm"
                class="flex items-center gap-2 px-3 py-1.5 bg-article-blue text-white text-sm rounded-lg hover:bg-article-blue/90 transition-colors"
            >
                {{ plus("w-4 h-4") }}
                Add Color
            </button>

            {# Add color form #}
            <form
                x-show="showForm"
                x-cloak
                hx-post="/app/settings/colors"
                hx-target="#colors-list"
                hx-swap="outerHTML"
                hx-on::after-request="document.querySelector('[x-data]').__x.$data.showForm = false"
                class="flex items-center gap-2"
            >
                <input
                    type="color"
                    name="hex_value"
                    value="#808080"
                    class="w-8 h-8 rounded cursor-pointer border-0 bg-transparent"
                >
                <input
                    type="text"
                    name="name"
                    placeholder="Color name..."
                    required
                    class="px-2 py-1 bg-dark-bg border border-dark-border rounded text-sm text-dark-text placeholder-dark-muted focus:outline-none focus:ring-1 focus:ring-article-blue"
                >
                <button
                    type="submit"
                    class="px-3 py-1.5 bg-article-blue text-white text-sm rounded hover:bg-article-blue/90 transition-colors"
                >
                    Add
                </button>
                <button
                    type="button"
                    @click="showForm = false"
                    class="px-3 py-1.5 bg-dark-bg border border-dark-border text-dark-text text-sm rounded hover:bg-dark-hover transition-colors"
                >
                    Cancel
                </button>
            </form>
        </div>
    </div>

    {# Colors list - can be swapped via HTMX #}
    <div id="colors-list">
        {% if colors and colors|length > 0 %}
        <div class="grid grid-cols-2 gap-3">
            {% for color in colors %}
            <div
                id="color-{{ color.id }}"
                class="flex items-center gap-3 p-3 bg-dark-bg rounded-lg border border-dark-border group"
            >
                <div
                    class="w-4 h-4 rounded-full flex-shrink-0"
                    style="background-color: {{ color.hex_value }};"
                ></div>
                <input
                    type="text"
                    value="{{ color.name }}"
                    hx-patch="/app/settings/colors/{{ color.id }}"
                    hx-trigger="blur changed, keyup[key=='Enter']"
                    hx-target="#color-{{ color.id }}"
                    hx-swap="outerHTML"
                    hx-include="this"
                    name="name"
                    class="flex-1 bg-transparent text-dark-text border-none outline-none focus:ring-1 focus:ring-article-blue rounded px-1 text-sm min-w-0"
                >
                <button
                    hx-delete="/app/settings/colors/{{ color.id }}"
                    hx-target="#colors-list"
                    hx-swap="outerHTML"
                    hx-confirm="Delete this color? Articles using it will have their color cleared."
                    class="p-1 text-dark-muted hover:text-article-red transition-colors opacity-0 group-hover:opacity-100"
                    title="Delete color"
                >
                    {{ trash_2("w-4 h-4") }}
                </button>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="py-4 text-center text-dark-muted">
            <p>No color labels configured</p>
        </div>
        {% endif %}
    </div>
</section>
